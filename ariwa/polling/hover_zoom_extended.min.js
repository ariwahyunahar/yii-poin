var dynamic_img = $('<div id="dynamic">');
var footer_div = $('<div></div>');
var notify_div = $('<div></div>');
var dynamic_img_width;
var dynamic_img_height;
var currentX = 0;
var currentY = 0;
var hover_zoom_element_src = '';
var aspect_ratio;
var meanPoint;
var range;
var window_width;
var window_height;
var available_width;
var available_height;
var xLeftTolerance = 15;
var xRightTolerance = 30;
var yTopTolerance = 15;
var yBottomTolerance = 45;
var maxZoomWidth = 1000;
var tid_load;
var tid_show;
var delay = 150;
var doNothing = false;
$(function() {
			$("body").keypress(function(event) {
						if (event.which == 2 || event.which == 98) {
							doNothing = !doNothing;
							if (doNothing) {
								dynamic_img.hide();
								footer_div.hide();
								showNotifyDiv('Disabled')
							} else {
								showNotifyDiv('Enabled')
							}
						}
					});
			function showNotifyDiv(state) {
				notify_div.text('Hover-Zoom ' + state);
				notify_div.slideDown().delay(500).slideUp()
			}
			window_width = $(window).width();
			window_height = $(window).height();
			notify_div.css('position', 'fixed');
			notify_div.css('left', window_width / 2 - 75);
			notify_div.css('top', '0px');
			notify_div.css('width', '130px');
			notify_div.css('height', '18px');
			notify_div.css('text-align', 'center');
			notify_div.css('z-index', '200');
			notify_div.css('background-color', 'rgb(56,165,222)');
			notify_div.css('text-shadow', '0px 1px 1px rgb(18,78,109)');
			notify_div.css('color', 'white');
			notify_div.css('font', '13px Calibri');
			notify_div.appendTo('body');
			notify_div.slideUp();
			$("body").on("mousemove", "img,.hover-zoom-element", function(e) {
						if (doNothing == true)
							return;
						currentX = e.pageX;
						currentY = e.pageY;
						calculateDynamicWidth(e.pageX, e.pageY)
					});
			$("body").on("mouseout", "img,.hover-zoom-element", function(e) {
						abortTimer(tid_load);
						abortTimer(tid_show);
						dynamic_img.hide();
						footer_div.hide()
					});
			$("body").on("mouseenter", "img,.hover-zoom-element", function(e) {
				if (doNothing == true)
					return;
				current_element = this;
				var imageSource;
				
				if($(current_element).attr('id'))
				if($(current_element).attr('id').substring(0,3)  == 'gb_'){
					imageSource = $(current_element).attr('src');
				}else{
					imageSource = null;
				}
				
				if (null != imageSource && imageSource != ""
						&& imageSource != "undefined") {
					if (imageSource[0] == "\"" || imageSource[0] == "'")
						imageSource = imageSource.substring(1,
								imageSource.length - 1)
				}
				if (hover_zoom_element_src != imageSource) {
					abortTimer(tid_show);
					abortTimer(tid_load);
					dynamic_img.hide();
					footer_div.hide();
					tid_load = setTimeout(function() {
								loadDynamicImage(current_element, currentX,
										currentY, imageSource)
							}, delay)
				}
			})
		});
function showDynamicImage() {
	dynamic_img.show();
	footer_div.show();
}
function loadDynamicImage(current_element, currentX, currentY, imageSource) {
	meanPoint = (current_element.getBoundingClientRect().left)
			+ ($(current_element).width()) / 2;
	range = (35 * ($(current_element).width()) / 100) / 2;
	$content = $("<img src=\'" + imageSource + "\' style='display:block;'/ width=\'350px\'>");
	dynamic_img.remove();
	dynamic_img = $('<div id="dynamic">');
	available_width = window_width - xLeftTolerance - xRightTolerance;
	available_height = window_height - yTopTolerance - yBottomTolerance;
	dynamic_img.css('max-width', maxZoomWidth + 'px');
	dynamic_img.css('max-height', available_height);
	dynamic_img.css('overflow', 'hidden');
	dynamic_img.css('text-align', 'left');
	hover_zoom_element_src = imageSource;
	dynamic_img.html($content);
	dynamic_img.css('backgroundColor', 'white');
	dynamic_img.css('border', '1px solid white');
	dynamic_img.css('position', 'absolute');
	dynamic_img.css('pointer-events', 'none');
	dynamic_img.css('-webkit-box-shadow', '0 1px 3px rgba(0, 0, 0, 0.5)');
	dynamic_img.css('-moz-box-shadow', '0 1px 3px rgba(0, 0, 0, 0.5)');
	dynamic_img.css('box-shadow', '0 1px 3px rgba(0, 0, 0, 0.5)');
	dynamic_img.css('border-bottom', 'none');
	dynamic_img.css('z-index', '1000000');
	dynamic_img.appendTo('body');
	calculateDynamicWidth(currentX, currentY);
	dynamic_img.show();
	footer_div.show()
}
function abortTimer(tid) {
	if (null != tid)
		clearTimeout(tid)
}
function calculateDynamicWidth(ePageX, ePageY) {
	var imgX;
	var imgY;
	var y_upper_limit;
	var y_lower_limit;
	var x_left_limit;
	var x_right_limit;
	var pageX = ePageX - $(document).scrollLeft();
	var pageY = ePageY - $(document).scrollTop();
	dynamic_img_width = dynamic_img.width();
	dynamic_img_height = dynamic_img.height();
	if (dynamic_img_width != 0 && dynamic_img_height != 0) {
		y_upper_limit = $(document).scrollTop() + yTopTolerance;
		y_lower_limit = $(document).scrollTop() + window_height
				- yBottomTolerance;
		x_left_limit = $(document).scrollLeft() + xLeftTolerance;
		x_right_limit = $(document).scrollLeft() + window_width
				- xRightTolerance;
		imgY = ePageY - dynamic_img_height / 2;
		if (imgY < y_upper_limit)
			imgY = y_upper_limit;
		if ((imgY + dynamic_img_height) > y_lower_limit) {
			imgY = y_lower_limit - dynamic_img_height
		}
		imgX = ePageX - dynamic_img_width / 2;
		if (imgX < x_left_limit)
			imgX = x_left_limit;
		if ((imgX + dynamic_img_width) > x_right_limit) {
			imgX = x_right_limit - dynamic_img_width
		}
		opacity = Math.abs(range / (ePageX - meanPoint)) + 0.1;
		dynamic_img.css('top', imgY);
		dynamic_img.css('left', imgX);
		// dynamic_img.css('opacity', opacity);
		footer_div.css('top', imgY + dynamic_img_height);
		footer_div.css('left', imgX);
		footer_div.css('width', dynamic_img_width - 12);
		// footer_div.css('opacity', opacity)
	} else {
	}
}
function calculateQuadrant(pageX, pageY) {
	var meanX = window_width / 2;
	if (pageX <= meanX) {
		available_width = window_height - xLeftTolerance - xRightTolerance;
		available_height = window_height - yTopTolerance - yBottomTolerance;
		return 1
	} else {
		available_width = window_height - xLeftTolerance - xRightTolerance;
		available_height = window_height - yTopTolerance - yBottomTolerance;
		return 2
	}
}